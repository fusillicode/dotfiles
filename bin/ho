#!/bin/bash

set -euo pipefail

# Get list of panes
wezterm_panes=$(wezterm cli list --format json)

# Get tab id of the pane from where `ho` is invoked
current_tab_id=$(echo $wezterm_panes | jq '.[] | select(.pane_id=='$WEZTERM_PANE') | .tab_id')

# Get first (we don't care which) pane id where Helix is running 
hx_pane_id=$(echo $wezterm_panes | jq '.[] | select(.tab_id=='$current_tab_id' and .title=="hx") | .pane_id')

# Exit if there's no pane with Helix running 
if [ -z "$hx_pane_id" ]; then
  echo -e "\n No pane running Helix found in current tab (id $current_tab_id) ðŸ˜ž"
  exit 1
fi

# Send "open file" cmd to Helix pane
wezterm cli send-text --pane-id $hx_pane_id ":o $1" --no-paste

# Simulate 'Enter' press to execute "open file" cmd in Helix pane
printf "\r" | wezterm cli send-text --pane-id "$hx_pane_id" --no-paste

# Focus Helix pane
wezterm cli activate-pane --pane-id $hx_pane_id
